function generate(){document.getElementsByClassName("error")[0].style.display="none",progress_start();let e="https://informalmakeitaquote.glitch.me/?",t=encodeURIComponent(document.querySelector(".icon_url").value),r=encodeURIComponent(document.querySelector(".content").value),n=encodeURIComponent(document.querySelector(".name").value),o=encodeURIComponent(document.querySelector(".id").value);0!=t.length&&(e+=`icon=${t}&`),0!=r.length?e+=`text=${r}&`:e+="text=%20&",0!=n.length?e+=`name=- ${n}&`:e+="name=%20&",0!=o.length&&"%40"!=o.substring(0,3)&&(o="%40"+o),0!=o.length?e+=`id=${o}&`:e+="id=%20&",document.querySelector(".debug").checked&&(e+="debug=2&"),"&"!=e.substring(e.length-1)&&"?"!=e.substring(e.length-1)||(e=e.substring(0,e.length-1)),document.querySelector(".generated_image").setAttribute("src",e)}function copy_url(){var e=document.createElement("textarea");e.textContent=url_params().href,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),alert("コピーしました！")}function url_params(){let e=new URL(`${location.origin+location.pathname}`),t=document.querySelector(".icon_url").value,r=document.querySelector(".content").value,n=document.querySelector(".name").value,o=document.querySelector(".id").value;return 0!=t.length&&e.searchParams.set("icon",t),0!=r.length&&e.searchParams.set("text",r),0!=n.length&&e.searchParams.set("name",n),0!=o.length&&e.searchParams.set("id",o),1==document.querySelector(".debug").checked&&e.searchParams.set("debug","true"),e}function progress_end(){document.getElementsByClassName("img_load")[0].setAttribute("style","display:none")}function progress_start(){document.getElementsByClassName("img_load")[0].setAttribute("style","display:block")}function image_reload(){progress_start();let e=document.querySelector(".generated_image"),t=e.src;t?(e.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQI12NgYAAAAAMAASDVlMcAAAAASUVORK5CYII=",e.src=t):(e.removeAttribute("src"),progress_end())}function dialog_open(){let e=document.querySelector(".tweetid_input_dialog");e.style.pointerEvents="auto",e.style.display="block",e.showModal()}async function get_tweet(){document.querySelector(".progress").style.display="block";let e="",t="",r="",n="",o=document.querySelector(".tweet_id_input").value;return/^((https?:\/\/)?(mobile.)?(twitter|x).com\/[a-z0-9_]+\/status\/(\d+))|^\d+$/i.test(o)?(o=o.replace(/^(https?:\/\/)?(mobile.)?(twitter|x).com\/[a-z0-9_]+\/status\//,""),/\d/.test(o)?(await fetch(`https://script.google.com/macros/s/AKfycbw6N5z0mR6gqmPgLXUE1sxaWJYP9NaWEq2fB1i3MqRUO9JD3KLVA5FgTV1lvN_x69QU/exec?url=${encodeURIComponent("https://cdn.syndication.twimg.com/tweet-result?token=0&lang=ja&id=")}${o}`).then(e=>{if(!e.ok)throw progress_end(),new Error;return e.text()}).then(o=>{o=o?JSON.parse(o):{},o=JSON.parse(o.response),e=o.text,t=o.user.name,r=o.user.screen_name,n=o.user.profile_image_url_https.replace(/_(normal|bigger|x96)\.(jpg|png)/,".$2"),console.log(o)}).catch(e=>{progress_end(),console.error("There was a problem with the fetch operation: ",e)}),document.querySelector(".progress").style.display="none",e=await replaceAsync(e,/https?:\/\/t.co\/[a-z0-9]*/gi,async(e,t)=>await get_t_co_url(e)),document.querySelector(".content").value=e,document.querySelector(".name").value=t,document.querySelector(".id").value=r,document.querySelector(".icon_url").value=n,void update()):error()):error()}function error(){alert("予期せぬエラーが発生しました。"),document.querySelector(".progress").style.display="none"}function update(){history.replaceState({},"",`${location.origin}${location.pathname}${url_params().search}`)}async function get_t_co_url(e){console.log("t.co: "+e);let t="";return await fetch(e).then(e=>{if(!e.ok)throw new Error;return e.text()}).then(e=>{t=e.match(/(?<=<title>).+(?=<\/title>)/i)[0]}).catch(e=>{console.error("There was a problem with the fetch operation: ",e)}),t}function replaceAsync(e,t,r){try{if("function"==typeof r){var n=[];return String.prototype.replace.call(e,t,function(){return n.push(r.apply(void 0,arguments)),""}),Promise.all(n).then(function(r){return String.prototype.replace.call(e,t,function(){return r.shift()})})}return Promise.resolve(String.prototype.replace.call(e,t,r))}catch(e){return Promise.reject(e)}}function reset(){document.querySelector(".content").value="",document.querySelector(".name").value="",document.querySelector(".id").value="",document.querySelector(".icon_url").value=""}window.addEventListener("DOMContentLoaded",function(){let e=new URL(location.href).searchParams;e.has("icon")&&decodeURIComponent(document.querySelector(".icon_url").value=e.get("icon")),e.has("text")&&decodeURIComponent(document.querySelector(".content").value=e.get("text")),e.has("name")&&decodeURIComponent(document.querySelector(".name").value=e.get("name")),e.has("id")&&decodeURIComponent(document.querySelector(".id").value=e.get("id")),e.has("debug")&&"true"==e.get("debug")&&(document.querySelector(".debug").checked=!0),document.getElementsByClassName("generated_image")[0].addEventListener("load",e=>{progress_end()}),document.getElementsByClassName("generated_image")[0].addEventListener("error",e=>{progress_end(),document.getElementsByClassName("error")[0].style.display="block"}),document.querySelectorAll(".icon_url,.content,.name,.id,.debug").forEach(e=>{e.addEventListener("input",e=>{update()})});let t=document.querySelector(".tweetid_input_dialog");t.addEventListener("click",function(e){e.target.closest(".tweetid_input_dialog .inner")?e.target==t.querySelector(".cancel")?t.close("cancel"):e.target==t.querySelector(".ok")&&t.close("ok"):t.close()}),t.addEventListener("close",async e=>{"ok"==t.returnValue&&get_tweet(),t.style.pointerEvents="none";const r=e=>Promise.allSettled(Array.from(e.getAnimations()).map(e=>e.finished));await r(e.target)})});