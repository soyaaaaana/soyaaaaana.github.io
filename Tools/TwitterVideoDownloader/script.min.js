function encodeHTML(e){let t=document.createElement("div");t.appendChild(document.createTextNode(e));let r=t.innerHTML;return t.remove(),r}function decodeHTML(e){let t=document.createElement("div");t.innerHTML=e;let r=t.innerText;return t.remove(),r}function progress_start(){document.querySelector(".progress").style.display="block"}function progress_end(){document.querySelector(".progress").style.display="none"}async function search(){progress_start();let e=document.querySelector(".tweet_url").value,t=/^((https?:\/\/)?(mobile.)?(twitter|x).com\/[a-z0-9_]+\/status\/(\d+))|^\d+$/i;if(!t.test(e))throw new Error(`${e} は有効な文字列ではありませんでした。`);if(e=e.match(t)[0].replace(/^(https?:\/\/)?(mobile.)?(twitter|x).com\/[a-z0-9_]+\/status\//i,""),!/\d/.test(e))throw new Error(`${e} は有効な文字列ではありませんでした。`);let r=[],o={0:[],1:[],2:[],3:[]},n={0:[],1:[],2:[],3:[]};await fetch(`https://script.google.com/macros/s/AKfycbw6N5z0mR6gqmPgLXUE1sxaWJYP9NaWEq2fB1i3MqRUO9JD3KLVA5FgTV1lvN_x69QU/exec?url=${encodeURIComponent("https://cdn.syndication.twimg.com/tweet-result?token=0&lang=ja&id=")}${e}`).then(e=>{if(!e.ok)throw progress_end(),new Error;return e.text()}).then(e=>{if(e=e?JSON.parse(e):{},"200"!=e.status||"200"!=e.response_code)throw new Error(`レスポンスが200ではありませんでした。\r\nGoogle Apps Script のレスポンスコード: ${e.status}, Twitter API のレスポンスコード: ${e.response_code}`);e=JSON.parse(e.response);let t=e.mediaDetails;for(let e=0;e<t.length;e++){if("video"!=t[e].type)continue;r.push(t[e].media_url_https);let s=t[e].video_info.variants;for(let t=0;t<s.length;t++)-1!=s[t].content_type.indexOf("video/")&&(o[e].push(s[t].bitrate),n[e].push(s[t].url))}console.log(e)}).catch(e=>{progress_end(),console.error("There was a problem with the fetch operation: ",e)}),console.log(o),console.log(n);let s="<hr>";for(let e=0;e<r.length;e++){let t="";for(let r=0;r<o[e].length;r++)0!=r&&(t+="<hr>"),t+=`ビットレート: ${encodeHTML(o[e][r])}<br>動画のURL: <a class="cp_link1" style="word-break:keep-all;overflow-wrap:anywhere;" target="_blank" rel="noopener noreferrer" href="${encodeHTML(n[e][r])}">${encodeHTML(n[e][r])}</a>`;console.log(t),s+=`<div style="display:flex;flex-direction:row"><div style="display:flex;align-items:center;margin-right:1em"><img src="${encodeHTML(r[e])}" style="max-width:10em;height:5em"></div><div>${t}</div></div><hr>`}document.querySelector(".data").innerHTML=s,progress_end()}