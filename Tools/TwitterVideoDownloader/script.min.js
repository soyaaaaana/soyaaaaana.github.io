function encodeHTML(e){let t=document.createElement("div");t.appendChild(document.createTextNode(e));let r=t.innerHTML;return t.remove(),r}function decodeHTML(e){let t=document.createElement("div");t.innerHTML=e;let r=t.innerText;return t.remove(),r}function insertString(e,t,r){return e.slice(0,t)+r+e.slice(t)}function progress_start(){document.querySelector(".progress").style.display="block"}function progress_end(){document.querySelector(".progress").style.display="none"}async function search(){progress_start();let e=document.querySelector(".tweet_url").value,t=/^((https?:\/\/)?(mobile.)?(twitter|x).com\/[a-z0-9_]+\/status\/(\d+))|^\d+$/i;if(!t.test(e)){let t=`${e} は有効な文字列ではありませんでした。`;throw output(t),new Error(t)}if(e=e.match(t)[0].replace(/^(https?:\/\/)?(mobile.)?(twitter|x).com\/[a-z0-9_]+\/status\//i,""),!/\d/.test(e)){let t=`${e} は有効な文字列ではありませんでした。`;throw output(t),new Error(t)}let r=[],o={0:[],1:[],2:[],3:[]},n={0:[],1:[],2:[],3:[]},l="",s=!1,i="";await fetch(`https://script.google.com/macros/s/AKfycbw6N5z0mR6gqmPgLXUE1sxaWJYP9NaWEq2fB1i3MqRUO9JD3KLVA5FgTV1lvN_x69QU/exec?url=${encodeURIComponent("https://cdn.syndication.twimg.com/tweet-result?token=0&lang=ja&id=")}${e}`).then(e=>{if(!e.ok)throw progress_end(),new Error;return e.text()}).then(e=>{if(e=e?JSON.parse(e):{},"200"!=e.status||"200"!=e.response_code)throw new Error(`レスポンスが200ではありませんでした。\r\nGoogle Apps Script のレスポンスコード: ${e.status}, Twitter API のレスポンスコード: ${e.response_code}`);if(e=JSON.parse(e.response),"TweetTombstone"==e.__typename){s=!0;let t=e.tombstone.text,r=t.entities;i=encodeHTML(t.text);let o=0;for(let e=0;e<r.length;e++){let t=`<a class="cp_link1" style="word-break:keep-all;overflow-wrap:anywhere;" target="_blank" rel="noopener noreferrer" href="${encodeHTML(r[e].ref.url)}">`,n="</a>";i=insertString(i,r[e].from_index+o,t),o+=t.length,i=insertString(i,r[e].to_index+o,n),o+=n.length}return}if("Tweet"!=e.__typename)return s=!0;let t=e.mediaDetails;for(let e=0;e<t.length;e++){if(l=t[e].type,"video"!=l&&"animated_gif"!=l)continue;r.push(t[e].media_url_https);let s=t[e].video_info.variants;for(let t=0;t<s.length;t++)-1!=s[t].content_type.indexOf("video/")&&(o[e].push(s[t].bitrate),n[e].push(s[t].url))}console.log(e)}).catch(e=>{progress_end(),console.error("There was a problem with the fetch operation: ",e),output(e)});let c="";if(s)c=i;else if(console.log(o),console.log(n),0!=r.length){c="<hr>";for(let e=0;e<r.length;e++){let t="";for(let r=0;r<o[e].length;r++)0!=r&&(t+="<hr>"),t+=`ビットレート: ${encodeHTML(o[e][r])} bps<br>動画のURL: <a class="cp_link1" style="word-break:keep-all;overflow-wrap:anywhere;" target="_blank" rel="noopener noreferrer" href="${encodeHTML(n[e][r])}">${encodeHTML(n[e][r])}</a><br>動画タイプ: ${encodeHTML(l)}`;console.log(t),c+=`<div style="display:flex;flex-direction:row"><div style="display:flex;align-items:center;margin-right:1em"><img src="${encodeHTML(r[e])}" style="max-width:10em;height:5em"></div><div>${t}</div></div><hr>`}}else c="ツイートに動画が存在しませんでした。";output(c)}function output(e){document.querySelector(".data").innerHTML=e,progress_end()}