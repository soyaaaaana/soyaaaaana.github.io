<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <title>RT 詳細表示</title>
    <meta content="ツイートをRTした人とRTした時刻などを表示します。" name="description">
    <script src="../../js/path-change.js"></script>
    <script src="../../js/no-ie.js"></script>
    <link rel="stylesheet" href="../../css/matter-0.2.2.min.css">
    <link rel="stylesheet" href="../../css/matter-darktheme.css">
    <link rel="stylesheet" href="../../css/tools-basic.css">
    <script>
      function encodeHTML(e){let t=document.createElement("div");t.appendChild(document.createTextNode(e));let n=t.innerHTML;return t.remove(),n}
      function decodeHTML(e){let t=document.createElement("div");t.innerHTML=e;let n=t.innerText;return t.remove(),n}
      async function show()
      {
        progress_start();
        /** @type {string[]} */
        let user_id = [];
        /** @type {string[]} */
        let tweet_id = [];
        /** @type {string[]} */
        let handle = [];
        /** @type {string[]} */
        let name = [];
        /** @type {number[]} */
        let timestamp = [];
        /** @type {string[]} */
        let image = [];
        /** @type {number} */
        let retweet_count = 0;
        
        await fetch(`https://api.twitterpicker.com/tweet/datav3?id=${document.querySelector(".tweet_id").value}`).then(response=>{
          if (!response.ok) {
            throw new Error();
            progress_end();
          }
          return response.json();
        }
        ).then(data=>{
          retweet_count = data.retweet_count;
        }
        ).catch(error=>{
          console.error('There was a problem with the fetch operation: ', error);
        }
        );
        document.querySelector(".tweet_detail").textContent = `RT数: ${retweet_count}`;
        await fetch(`https://api.twitterpicker.com/tweet/retweets?id=${document.querySelector(".tweet_id").value}`).then(response=>{
          if (!response.ok) {
            throw new Error();
            progress_end();
          }
          return response.json();
        }
        ).then(data=>{
          for(let i = 0;i<data.length;i++)
          {
            user_id.push(data[i]["user_id"])
            tweet_id.push(data[i]["tweet_id"])
            handle.push(data[i]["handle"])
            name.push(data[i]["name"])
            timestamp.push(data[i]["timestamp"])
            image.push(data[i]["image"])
          }
        }
        ).catch(error=>{
          console.error('There was a problem with the fetch operation: ', error);
          progress_end();
        }
        );
        let html = `<hr>`;
        for (let i = 0;i<user_id.length;i++)
        {
          html += `<div style="display:flex;flex-direction:row"><div style="display:flex;align-items:center;margin-right:1em"><img src="${encodeHTML(image[i].replace("_normal.","."))}" style="width:5em;height:5em;border-radius:50%;"></div><div style="display:flex;flex-direction:column">名前: ${encodeHTML(name[i])}<br>RTした時刻: ${encodeHTML(new Date(timestamp[i]).toLocaleDateString('ja-JP'))} ${encodeHTML(new Date(timestamp[i]).toLocaleTimeString('ja-JP'))}<br>ハンドル: @${encodeHTML(handle[i])}<br>user_id: ${encodeHTML(user_id[i])}<br>RTのURL: <a class="cp_link1" style="word-break:keep-all;overflow-wrap:anywhere;" href="https://x.com/i/status/${encodeHTML(tweet_id[i])}" target="_blank" rel="noopener noreferrer">https://x.com/i/status/${encodeHTML(tweet_id[i])}</a>プロフィール画像: <a class="cp_link1" style="word-break:keep-all;overflow-wrap:anywhere;" href="${encodeHTML(image[i].replace("_normal.","."))}" target="_blank" rel="noopener noreferrer">${encodeHTML(image[i].replace("_normal.","."))}</a></div></div><hr>`
        }
        document.querySelector(".data").innerHTML = html;
        progress_end();
      }
      function progress_end()
      {
        document.querySelector(".progress").setAttribute("style","display:none");
      }
      function progress_start()
      {
        document.querySelector(".progress").setAttribute("style","display:block");
      }
    </script>
    <style>
      @font-face {
        font-family: "NotoColorEmoji";
        src: url("../../webfonts/NotoColorEmoji-Regular.ttf");
        font-weight: 400;
        font-style: normal;
      }
    </style>
  </head>
  <body class="defaultfont">
    <p class="site-message" style="word-break:keep-all;overflow-wrap:anywhere"><div style="font-size:22.5px;margin-bottom:-0.75em">RT 詳細表示</div><br>ツイートをRTした人とRTした時刻などを表示します。<br>※全て表示できるわけではありません。</p>
    <label class="matter-textfield-outlined darktheme">
      <span class="matter-tooltip"><span id="tooltip" aria-hidden="true" style="font-size:12.5px;line-height:20px;margin-bottom:-4;">ツイートのIDをここに入力します。</span></span>
      <input class="tweet_id" placeholder=" " style="width:90vw"></input>
      <span>ツイートのID</span>
    </label>
    <div style="margin-bottom: -0.75em;"><span class="br"></span></div>
    <div style="display:flex;align-items:center"><button class="matter-button-contained" onclick="show()">表示</button><div style="margin-left:1em" class="tweet_detail"></div></div>
    <div class="progress" style="display:none"><progress class="matter-progress-circular" style="margin-top: 0.75em;"></progress><div><span class="br"></span></div></div>
    <div style="margin-bottom: -0.75em;"><span class="br"></span></div>
    <div class="data"></div>
  </body>
</html>